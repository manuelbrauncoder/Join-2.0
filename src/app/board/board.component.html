<main>
  <div class="headline">
    <h1 (click)="userService.addLocalUsersToFirebase()" class="v2-t1">Board</h1>
    <div class="search">
      <div class="input-wrapper">
        <input [(ngModel)]="searchInput" type="text" class="input-field" placeholder="Find Task" />
        <img src="assets/img/divider-vertical.png" alt="">
        <img src="assets/img/icon-search.png" alt="">

      </div>
      <button (click)="toggleOverlay()" class="primary">
        Add task 
        <img src="assets/img/plus-icon-white.png" alt="">
      </button>
    </div>
  </div>

  <div class="task-container">
    <div class="tasks-column">
      <div class="header">
        <h3>To do</h3>
        <img src="assets/img/board-plus-btn.png" alt="" />
      </div>
      <div
        id="todoList"
        [cdkDropListConnectedTo]="['feedbackList', 'progressList', 'doneList']"
        cdkDropList
        [cdkDropListData]="filterTasks('todo')"
        cdkDropListSortingDisabled
        (cdkDropListDropped)="drop($event, 'todo')"
        class="tasks"
      >
        @for (task of filteredTasks() | filterTasks: 'todo'; track
        $index) {
        <div
          (click)="openDetailCard(task)"
          class="drag-container"
          cdkDragBoundary=".task-container"
          [cdkDragStartDelay]="500"
          cdkDrag
        >
          <app-board-task-card [task]="task"></app-board-task-card>
          <div class="placeholder" *cdkDragPlaceholder></div>
        </div>
        } @empty {<app-board-task-card-empty [status]="'todo'"></app-board-task-card-empty>}
      </div>
    </div>
    <div class="tasks-column">
      <div class="header">
        <h3>In progress</h3>
        <img src="assets/img/board-plus-btn.png" alt="" />
      </div>
      <div
        id="progressList"
        [cdkDropListConnectedTo]="['feedbackList', 'doneList', 'todoList']"
        cdkDropList
        [cdkDropListData]="filterTasks('progress')"
        cdkDropListSortingDisabled
        (cdkDropListDropped)="drop($event, 'progress')"
        class="tasks"
      >
        @for (task of filteredTasks() | filterTasks: 'progress';
        track $index) {

        <div
          (click)="openDetailCard(task)"
          class="drag-container"
          cdkDragBoundary=".task-container"
          [cdkDragStartDelay]="500"
          cdkDrag
        >
          <app-board-task-card [task]="task"></app-board-task-card>
          <div class="placeholder" *cdkDragPlaceholder></div>
        </div>

        } @empty {<app-board-task-card-empty  [status]="'progress'"></app-board-task-card-empty>}
      </div>
    </div>
    <div class="tasks-column">
      <div class="header">
        <h3>Await feedback</h3>
        <img src="assets/img/board-plus-btn.png" alt="" />
      </div>
      <div
        id="feedbackList"
        [cdkDropListConnectedTo]="['doneList', 'progressList', 'todoList']"
        cdkDropList
        [cdkDropListData]="filterTasks('feedback')"
        cdkDropListSortingDisabled
        (cdkDropListDropped)="drop($event, 'feedback')"
        class="tasks"
      >
        @for (task of filteredTasks() | filterTasks: 'feedback';
        track $index) {

        <div
          (click)="openDetailCard(task)"
          class="drag-container"
          cdkDragBoundary=".task-container"
          [cdkDragStartDelay]="500"
          cdkDrag
        >
          <app-board-task-card [task]="task"></app-board-task-card>
          <div class="placeholder" *cdkDragPlaceholder></div>
        </div>

        } @empty {<app-board-task-card-empty  [status]="'feedback'"></app-board-task-card-empty>}
      </div>
    </div>
    <div class="tasks-column">
      <div class="header">
        <h3>Done</h3>
        <img src="assets/img/board-plus-btn.png" alt="" />
      </div>
      <div
        id="doneList"
        [cdkDropListConnectedTo]="['feedbackList', 'progressList', 'todoList']"
        cdkDropList
        [cdkDropListData]="filterTasks('done')"
        cdkDropListSortingDisabled
        (cdkDropListDropped)="drop($event, 'done')"
        class="tasks"
      >
        @for (task of filteredTasks() | filterTasks: 'done'; track
        $index) {

        <div
          (click)="openDetailCard(task)"
          class="drag-container"
          cdkDragBoundary=".task-container"
          [cdkDragStartDelay]="500"
          cdkDrag
        >
          <app-board-task-card [task]="task"></app-board-task-card>
          <div class="placeholder" *cdkDragPlaceholder></div>
        </div>

        } @empty {
        <app-board-task-card-empty  [status]="'done'"></app-board-task-card-empty>
        }
      </div>
    </div>
  </div>
</main>

@if (showAddTaskOverlay) {
  <div @toggleOverlay class="overlay">
    <app-add-task-form (dialogOpen)="hideOverlay(false)" [openInDialog]="true"></app-add-task-form>
  </div>

  <div (click)="toggleOverlay()" class="background"></div>
}

@if (showDetailCard) {
  <div class="overlay">
    <app-board-task-detail-card [currentTask]="taskForDetail"></app-board-task-detail-card>
  </div>

  <div (click)="toggleDetailCard()" class="background"></div>
}
